{
    "id": 62350,
    "kind": "MARKDOWN",
    "auditfirm_id": 11,
    "impact": "HIGH",
    "finders_count": 3,
    "protocol_id": 3402,
    "title": "`Licredity::decreaseDebtShare` bypasses interest accrual",
    "content": "**Description:** A borrower can call [`Licredity::decreaseDebtShare`](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L472-L536) to repay their loan. Because this call can only reduce debt, it’s treated as “safe” and allowed outside the [`Licredity::unlock`](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L86-L110) flow. However, interest accrues only during [`unlock`](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L89-L90), [`swap`](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L713), and liquidity [add](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L670)/[remove](https://github.com/Licredity/licredity-v1-core/blob/e8ae10a7d9f27529e39ca277bf56cef01a807817/src/Licredity.sol#L698) operations. Therefore calling `decreaseDebtShare` directly therefore uses the last `totalDebtBalance/totalDebtShare` without first accruing interest, so the repayment is computed from a stale state.\n\n**Impact:** Borrowers can avoid paying accrued interest when repaying via direct calls, reducing yield for LPs and protocol revenue. While interest will still accrue when other participants trigger the hook (e.g., borrows/trades/LP actions), repayments executed before such events effectively skip the borrower’s interest share. Even if unintentional and harder to time in an active market, this lowers realized interest, distorts accounting, and reduces net APY.\n\n**Proof of Concept:** Add the following test to `LicredityUnlockPosition.t.sol`:\n```solidity\nfunction test_decraseDebtBalance_doesntAccrueInterest() public {\n    uint256 positionId = licredityRouter.open();\n    licredityRouter.depositFungible{value: 10e8}(positionId, Fungible.wrap(ChainInfo.NATIVE), 10e8);\n\n    uint256 delta = 1e8 * 1e6;\n\n    licredityRouterHelper.addDebt(positionId, delta, address(this));\n    uint256 amountBorrowed = licredity.balanceOf(address(this));\n\n    // should cause interest accrual\n    oracleMock.setQuotePrice(2 ether);\n    vm.warp(block.timestamp + 180 days);\n\n    // decrease debt share call is done directly to licredity\n    // avoiding the `unlock` context that accrues interest\n    uint256 amountRepaid = licredity.decreaseDebtShare(positionId, delta, false);\n\n    // no interest has been accrued\n    assertEq(amountRepaid, amountBorrowed);\n}\n```\n\n**Recommended Mitigation:** Accrue interest at the start of `decreaseDebtShare` (pull accrual) or require `decreaseDebtShare` to be callable only within the `unlock` context.\n\n\n**Licredity:** Fixed in [PR#59](https://github.com/Licredity/licredity-v1-core/pull/59/files), commits [`8ca2a35`](https://github.com/Licredity/licredity-v1-core/commit/8ca2a35e2af1db4e0ae2f92c779df96f42d18286), and [`81e54c0`](https://github.com/Licredity/licredity-v1-core/commit/81e54c0e62a5cda990e715061d099b03e9632d04)\n\n**Cyfrin:** Verified. Interest is now accrued in `decreaseDebtShare`.\n\n\\clearpage",
    "summary": "\nThe report discusses a bug in the Licredity protocol, where borrowers are able to avoid paying accrued interest when repaying their loans through direct calls. This impacts the yield for LPs and protocol revenue, as interest only accrues during specific operations. The bug has been confirmed through a proof of concept test and has been fixed in a recent update to the protocol. The recommended mitigation is to either accrue interest at the start of the `decreaseDebtShare` function or restrict it to only be callable within the `unlock` context. The bug has been verified by Cyfrin and interest is now properly accrued in the `decreaseDebtShare` function. ",
    "report_date": "2025-09-01T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/solodit/solodit_content/blob/main/reports/Cyfrin/2025-09-01-cyfrin-licredity-v2.0.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "licreditydecreasedebtshare-bypasses-interest-accrual-cyfrin-none-licredity-markdown",
    "firm_name": "Cyfrin",
    "firm_logo_square": "Cyfrin_square.jpg",
    "protocol_name": "Licredity",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Immeas"
            }
        },
        {
            "wardens_warden": {
                "handle": "Alexzoid"
            }
        },
        {
            "wardens_warden": {
                "handle": "ChainDefenders](https://x.com/ChDefendersEth) ([0x539](https://x.com/1337web3) & [PeterSR"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Cyfrin",
        "logo_square": "Cyfrin_square.jpg"
    },
    "protocols_protocol": {
        "name": "Licredity",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}