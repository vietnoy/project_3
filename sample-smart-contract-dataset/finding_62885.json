{
    "id": 62885,
    "kind": "PDF",
    "auditfirm_id": 6,
    "impact": "HIGH",
    "finders_count": 4,
    "protocol_id": 3419,
    "title": "Missing transaction validation of EIP-7623 data ï¬‚oor gas in consensus",
    "content": "## High Risk Severity Report\n\n## Context\n- `lib.rs#L76-L125`\n\n## Description\nThe consensus code present in `monad-eth-block-policy` is missing transaction static validation of **EIP-7623: Data Floor Gas**, which changes calldata pricing for transactions with large calldata. This is a problem because the execution code does implement EIP-7623 as part of the Prague fork during static validation of the transaction.\n\n### Relevant Code Snippet (`validate_transaction.cpp#L97-L102`)\n```cpp\n// EIP-7623\nif constexpr (rev >= EVMC_PRAGUE) {\n    if (MONAD_UNLIKELY(floor_data_gas(tx) > tx.gas_limit)) {\n        return TransactionError::IntrinsicGasGreaterThanLimit;\n    }\n}\n```\n\nSo a transaction that passes static validation in consensus will be rejected during static validation in execution. During execution, this transaction is considered an invalid transaction, which is different from a reverting transaction, and the function `execute` will return early and return an error via `BOOST_OUTCOME_TRY`.\n\n### Relevant Code Snippet (`execute_transaction.cpp#L220-L232`)\n```cpp\nResult<ExecutionResult> execute(\n    Chain const &chain, uint64_t const i, Transaction const &tx,\n    Address const &sender, BlockHeader const &hdr,\n    BlockHashBuffer const &block_hash_buffer, BlockState &block_state,\n    BlockMetrics &block_metrics, boost::fibers::promise<void> &prev\n) {\n    // ...\n    BOOST_OUTCOME_TRY(static_validate_transaction<rev>(\n        tx,\n        hdr.base_fee_per_gas,\n        chain.get_chain_id(),\n        chain.get_max_code_size(hdr.number, hdr.timestamp)\n    ));\n}\n```\n\n### Relevant Code Snippet (`execute_block.cpp#L213-L224`)\n```cpp\nfor (unsigned i = 0; i < block.transactions.size(); ++i) {\n    MONAD_ASSERT(results[i].has_value());\n    if (MONAD_UNLIKELY(results[i].value().has_error())) {\n        LOG_ERROR(\n            \"tx {} {} validation failed: {} \",\n            i,\n            block.transactions[i],\n            results[i].value().assume_error().message().c_str()\n        );\n    }\n    BOOST_OUTCOME_TRY(auto retval, std::move(results[i].value()));\n    retvals.push_back(std::move(retval));\n}\n```\n\nWhat makes this a problem is that the transaction is invalid (different from a revert), returns an error, but no gas is actually charged for it since `execute` will exit early. In Monad, nodes agree on the transactions to execute before actually executing them. This means that an attacker can set a transaction with a large gas limit but does not obey EIP-7623. This passes static validation in consensus code but fails static validation in execution code. As a result, this transaction can occupy space in a proposal without the attacker needing to pay any gas for it, leading to a reliable denial-of-service vector.\n\n## Recommendation\nValidate EIP-7623 in the consensus code in `monad-eth-block-policy` (`lib.rs#L77`) as well.\n\n## Category\n**Labs:** Fixed in PR 2139.\n\n## Spearbit\n**Fix verified.**",
    "summary": "\nThe report discusses a high risk bug in a code library called `monad-eth-block-policy`. This library is missing a validation for a feature called EIP-7623, which changes the pricing for transactions with large amounts of data. This means that a transaction that is considered valid by the consensus code will be rejected during execution, leading to errors and potential denial-of-service attacks. The recommendation is to fix this issue by adding the validation in the consensus code as well. The bug has been fixed in a pull request and verified by the team. ",
    "report_date": "2025-09-19T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "github_link": "",
    "pdf_link": "https://solodit-bucket.s3.amazonaws.com/storage/reports/spearbit/Monad-Spearbit-Security-Review-September-2025.pdf",
    "pdf_page_from": 8,
    "contest_id": "",
    "slug": "missing-transaction-validation-of-eip-7623-data-floor-gas-in-consensus-spearbit-none-monad-pdf",
    "firm_name": "Spearbit",
    "firm_logo_square": "spearbit_square.png",
    "protocol_name": "Monad",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Haxatron"
            }
        },
        {
            "wardens_warden": {
                "handle": "Dtheo"
            }
        },
        {
            "wardens_warden": {
                "handle": "Guido Vranken"
            }
        },
        {
            "wardens_warden": {
                "handle": "Rikard Hjort"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Spearbit",
        "logo_square": "spearbit_square.png"
    },
    "protocols_protocol": {
        "name": "Monad",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}