{
    "id": 62486,
    "kind": "GIT",
    "auditfirm_id": 3,
    "impact": "HIGH",
    "finders_count": 5,
    "protocol_id": 3104,
    "title": "H-5: `migrateRewardPool` Fails Due to Incompatible Storage Design in `CurveConvexLib`",
    "content": "\nSource: https://github.com/sherlock-audit/2025-06-notional-exponent-judging/issues/485 \n\nThis issue has been acknowledged by the team but won't be fixed at this time.\n\n## Found by \nLedger\\_Patrol, bretzel, mstpr-brainbot, tjonair, xiaoming90\n\n### Summary\n\nThe [`migrateRewardPool`](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/main/notional-v4/src/rewards/AbstractRewardManager.sol#L44-L65) function in the `AbstractRewardManager` contract is designed to migrate rewards from an old Convex reward pool to a new one by updating internal storage, withdrawing from old reward pool and depositing into the new reward pool. This mechanism relies on writing to local storage slots (e.g., `_getRewardPoolSlot()`), via delegatecall from a yield strategy contract.\n\nIn practice, this fails because when `CurveConvex2Token` is deployed, it deploys `CurveConvexLib`, where reward pool address is immutable. The `CurveConvex2Token` stores the address of `CurveConvexLib` into another immutable variable.\n\nSince the reward pool address is immutable in `CurveConvexLib`, whenever Lp token is minted, the `CurveConvex2Token` deposit them to the same reward pool even if reward pool is changed in reward manager. There is no migration possible in `CurveConvex2Token`. This breaks the core migration functionality, despite the function being exposed and annotated for use when the reward pool changes.\n\nThis violates the IRewardManager interface contract [NATSPEC](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/main/notional-v4/src/interfaces/IRewardManager.sol#L82-L86), which states that `migrateRewardPool` should be used both initially and when the reward pool changes â€” of which reward pool change can be accomplished properly in this case.\n\n\n### Root Cause\n\nNone\n\n### Internal Pre-conditions\n\nNone\n\n### External Pre-conditions\n\nConvex protocol can decide to deprecate an old pool and create a new one\n\n### Attack Path\n\nNone\n\n### Impact\n\nReward pool cannot be changed when convex migrates to a new reward pool\n\n### PoC\n\n_No response_\n\n### Mitigation\n\nCreate a migration logic for `CurveConvex2Token` where reward pool can be migrated from one to another\n\n",
    "summary": "\nThis report discusses an issue with the `migrateRewardPool` function in the `AbstractRewardManager` contract. This function is meant to migrate rewards from an old Convex reward pool to a new one, but it fails in practice because the `CurveConvex2Token` contract has an immutable reward pool address. This means that even if the reward pool is changed in the reward manager, the `CurveConvex2Token` will still deposit tokens into the old reward pool. This violates the contract's interface and prevents the reward pool from being changed when Convex creates a new one. The team has acknowledged this issue but will not be fixing it at this time. A possible solution would be to create a migration logic for `CurveConvex2Token` so that the reward pool can be properly migrated from one to another.",
    "report_date": "2025-07-18T15:00:00.000Z",
    "contest_prize_txt": "75500 USDC",
    "contest_link": "https://app.sherlock.xyz/audits/contests/1001",
    "sponsor_name": "",
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "",
    "github_link": "https://github.com/sherlock-audit/2025-06-notional-exponent-judging/issues/485",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "1001",
    "slug": "h-5-migraterewardpool-fails-due-to-incompatible-storage-design-in-curveconvexlib-sherlock-notional-exponent-git",
    "firm_name": "Sherlock",
    "firm_logo_square": "sherlock_square.png",
    "protocol_name": "Notional Exponent",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "tjonair"
            }
        },
        {
            "wardens_warden": {
                "handle": "bretzel"
            }
        },
        {
            "wardens_warden": {
                "handle": "Ledger\\_Patrol"
            }
        },
        {
            "wardens_warden": {
                "handle": "xiaoming90"
            }
        },
        {
            "wardens_warden": {
                "handle": "mstpr-brainbot"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Sherlock",
        "logo_square": "sherlock_square.png"
    },
    "protocols_protocol": {
        "name": "Notional Exponent",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}