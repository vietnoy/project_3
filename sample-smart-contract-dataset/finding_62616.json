{
    "id": 62616,
    "kind": "MARKDOWN",
    "auditfirm_id": 16,
    "impact": "LOW",
    "finders_count": 1,
    "protocol_id": 3421,
    "title": "[L-19] Revocation may fail after currency update allowing exploits",
    "content": "\n_Acknowledged_\n\nThe `revokeListing()` function in `Marketplace.sol` has a critical issue that prevents users from revoking their listings if the `acceptedCurrency` has been updated since the listing was created.\n\nThis occurs because the function uses the current `acceptedCurrency` value when generating the signature hash to validate the revocation request:\n\n```solidity\nbytes32 listingHash = generateListingSignatureHash(listing.request);\n```\nLooking at `generateListingSignatureHash()`:\n```solidity\nfunction generateListingSignatureHash(ListingRequest calldata listing) public view returns (bytes32) {\n    return _hashTypedDataV4(\n        keccak256(\n            abi.encode(\n                //...\n                acceptedCurrency,  // Current value used here\n                //...\n```\n\nWhen a user creates a listing, the signature is generated with the then-current `acceptedCurrency` address. If an admin later updates the `acceptedCurrency` through `setAcceptedCurrency()`, any attempt to revoke a listing will fail because the calculated `listingHash` will be different.\nThe impact is:\n* Users cannot revoke outdated listings that might have long deadlines (e.g., 1 month).\n* If the `acceptedCurrency` is ever switched back to the original token address, outdated listings suddenly become valid again.\n* Attackers could wait for such a situation and then immediately execute the outdated listings at potentially disadvantageous prices for the seller.\n\nWhen the marketplace admin reverts to a previously used token, there's a race condition where users must quickly revoke their old listings, but many will likely fail to do so in time, creating a window of opportunity for exploitation.\n\nRecommendations:\nThis can be resolved by, Track historical currencies, Maintain a mapping of historical currency addresses and allow users to specify which currency was used when revoking.\n\n\n\n",
    "summary": "",
    "report_date": "2025-09-11T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/pashov/audits/blob/master/team/md/RipIt-security-review_2025-05-10.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "l-19-revocation-may-fail-after-currency-update-allowing-exploits-pashov-audit-group-none-ripit_2025-05-10-markdown",
    "firm_name": "Pashov Audit Group",
    "firm_logo_square": "Pashov_square.png",
    "protocol_name": "RipIt_2025-05-10",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Pashov Audit Group"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Pashov Audit Group",
        "logo_square": "Pashov_square.png"
    },
    "protocols_protocol": {
        "name": "RipIt_2025-05-10",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}