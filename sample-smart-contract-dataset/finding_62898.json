{
    "id": 62898,
    "kind": "PDF",
    "auditfirm_id": 6,
    "impact": "MEDIUM",
    "finders_count": 4,
    "protocol_id": 3419,
    "title": "CREATE / CREATE2 opcode checks incorrect max initcode size",
    "content": "## Severity: Medium Risk\n\n**Context:** `create.hpp#L42`\n\n**Description:**  \nIn Monad VM, the CREATE / CREATE2 opcode implementation does a max initcode size check and rejects initcode that is above `0xC000` (49152 bytes).\n\n```cpp\ncreate.hpp#L42:\nif constexpr (Rev >= EVMC_SHANGHAI) {\n    if (MONAD_VM_UNLIKELY(*size > 0xC000)) {\n        ctx->exit(StatusCode::OutOfGas);\n    }\n}\n```\n\nThis matches Ethereum mainnet's parameters, where `max_init_code_size = 2 * max_code_size`, and `max_code_size = 24576`. However, Monad Chain defines a different parameter for `max_code_size`, which we can see:\n\n```cpp\nmonad_chain.cpp#L62-L64:\nif (MONAD_LIKELY(monad_rev >= MONAD_TWO)) {\n    return 128 * 1024;\n}\n```\n\nAs seen above, the `max_code_size` for Monad revision 2 and above is `128 * 1024` (131072). This means the actual `max_init_code_size` should be `2 * max_code_size` (262144), however, the CREATE / CREATE2 opcode implementation will reject any initcode above 49152 bytes. \n\nThis means that while Monad attempts to allow the creation of contracts up to a `max_code_size` of 128 kB, in actual fact, it only allows the creation of contracts up to 48 kB, since the initcode, which should consist of both the constructor code and the contract code, only allows 48 kB for both. This might cause certain factory contracts to be bricked, for instance.\n\n**Recommendation:**  \nInstead of hardcoding the value to `0xC000` (49152 bytes), the check needs to be changed to use `2 * max_code_size` fetched from the Monad chain config.\n\n**Category Labs:** Fixed in PR 1440.  \n\n**Spearbit:** Fix verified.",
    "summary": "\nThis bug report discusses an issue with the CREATE / CREATE2 opcode implementation in the Monad VM. The implementation checks for a max initcode size and rejects any initcode that is above 49152 bytes. However, this does not match the parameters set by the Monad Chain, which defines a different max code size of 128 kB. This means that while Monad attempts to allow the creation of contracts up to 128 kB, it actually only allows up to 48 kB due to the initcode size limitation. The recommendation is to change the check to use the correct max code size from the Monad chain config. The bug has been fixed in PR 1440 and verified by Spearbit. ",
    "report_date": "2025-09-19T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "github_link": "",
    "pdf_link": "https://solodit-bucket.s3.amazonaws.com/storage/reports/spearbit/Monad-Spearbit-Security-Review-September-2025.pdf",
    "pdf_page_from": 26,
    "contest_id": "",
    "slug": "create-create2-opcode-checks-incorrect-max-initcode-size-spearbit-none-monad-pdf",
    "firm_name": "Spearbit",
    "firm_logo_square": "spearbit_square.png",
    "protocol_name": "Monad",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Haxatron"
            }
        },
        {
            "wardens_warden": {
                "handle": "Dtheo"
            }
        },
        {
            "wardens_warden": {
                "handle": "Guido Vranken"
            }
        },
        {
            "wardens_warden": {
                "handle": "Rikard Hjort"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Spearbit",
        "logo_square": "spearbit_square.png"
    },
    "protocols_protocol": {
        "name": "Monad",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}