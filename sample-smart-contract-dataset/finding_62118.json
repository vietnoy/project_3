{
    "id": 62118,
    "kind": "GIT",
    "auditfirm_id": 3,
    "impact": "MEDIUM",
    "finders_count": 6,
    "protocol_id": 3135,
    "title": "M-7: DoS in Redemption Due to Unchecked Asset Support in Subvaults",
    "content": "\nSource: https://github.com/sherlock-audit/2025-07-mellow-flexible-vaults-judging/issues/688 \n\n## Found by \n7, HeckerTrieuTien, Sparrow\\_Jac, dan\\_\\_vinci, jasonxiale, silver\\_eth\n\n### Summary\n\nIn Mellow Flexible Vaults, the `getLiquidAssets()` logic aggregates token balances from all subvaults without checking whether a given asset is supported by each subvault. Since subvaults are expected to restrict supported assets via the allowedAssets mapping, calling `hookPullAssets()` on a subvault holding an unsupported asset (even 1 wei) will trigger a revert due to the `NotAllowedAsset` check inside `modifySubvaultBalance()`.\n\nThis leads to a  denial-of-service condition as any user can send a trivial amount of the queue asset (1 wei) to a `subvault` that doesn't support it. As a result, future redemption requests for that asset via `redeem()` will revert during the `callHook()` phase, making redemptions impossible.\n\n\n\n\n### Root Cause\n\nThe root cause lies in the fact that the system aggregates `IERC20(asset).balanceOf(subvault)` across all subvaults during `getLiquidAssets()` and then attempts to `hookPullAssets()` from each of them, without verifying if the asset is permitted by that subvault. If even a single subvault holds a non-zero balance of an unsupported asset, `modifySubvaultBalance()` will revert.\n\n\n\n### Internal Pre-conditions\n\nA `Subvault` exists but does not include the given asset in its `allowedAssets`.\n\n\n\n### External Pre-conditions\n\nnill\n\n### Attack Path\n\n1. Attacker identifies a subvault that does not support the redemption asset.\n\n2. Sends 1 wei of the redemption asset directly to the subvault.\n\n3. When any user tries to redeem via `redeem()`, it calls `callHook()` internally.\n\n4. `callHook()` attempts to aggregate and pull assets from all subvaults.\n\n5. The presence of 1 wei in the unsubscribed subvault causes `modifySubvaultBalance()` to revert with `NotAllowedAsset`, permanently breaking redemption functionality.\n\n\n### Impact\n\nAny user can prevent all redemptions for an asset by sending a trivial amount to a subvault that does not support it. This breaks a core vault function, locking user funds indefinitely unless manually cleaned up by governance.\n\n### PoC\n\nnill\n\n### Affected Code\nhttps://github.com/sherlock-audit/2025-07-mellow-flexible-vaults/blob/eca8836d68d65bcbfc52c6f04cf6b4b1597555bf/flexible-vaults/src/queues/SignatureRedeemQueue.sol#L13-L27\n\nhttps://github.com/sherlock-audit/2025-07-mellow-flexible-vaults/blob/eca8836d68d65bcbfc52c6f04cf6b4b1597555bf/flexible-vaults/src/hooks/BasicRedeemHook.sol#L33-L41\n\nhttps://github.com/sherlock-audit/2025-07-mellow-flexible-vaults/blob/eca8836d68d65bcbfc52c6f04cf6b4b1597555bf/flexible-vaults/src/managers/RiskManager.sol#L236-L253\n\n### Mitigation\n\nBefore summing up the liquid assets or attempting to pull balances from subvaults, explicitly check that the subvault allows the asset:\n```solidity\nif (!vault.riskManager().isAllowedAsset(subvault, asset)) {\n    continue;\n}\n```\n\n\n## Discussion\n\n**sherlock-admin2**\n\nThe protocol team fixed this issue in the following PRs/commits:\nhttps://github.com/mellow-finance/flexible-vaults/pull/14/files\n\n\n\n\n",
    "summary": "\nIn the Mellow Flexible Vaults protocol, there is a bug that allows users to prevent redemptions for a specific asset by sending a small amount of that asset to a subvault that does not support it. This is due to the system aggregating token balances from all subvaults without checking if the asset is supported by each subvault. As a result, future redemption requests for that asset will fail, causing a denial-of-service condition. The root cause is the lack of verification for supported assets in the `getLiquidAssets()` function. This can be mitigated by explicitly checking if the subvault allows the asset before aggregating balances. The protocol team has fixed this issue in a recent pull request. ",
    "report_date": "2025-07-28T15:00:00.000Z",
    "contest_prize_txt": "70000 USDC",
    "contest_link": "https://app.sherlock.xyz/audits/contests/964",
    "sponsor_name": "",
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "",
    "github_link": "https://github.com/sherlock-audit/2025-07-mellow-flexible-vaults-judging/issues/688",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "964",
    "slug": "m-7-dos-in-redemption-due-to-unchecked-asset-support-in-subvaults-sherlock-mellow-flexible-vaults-git",
    "firm_name": "Sherlock",
    "firm_logo_square": "sherlock_square.png",
    "protocol_name": "Mellow Flexible Vaults",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "HeckerTrieuTien"
            }
        },
        {
            "wardens_warden": {
                "handle": "dan\\_\\_vinci"
            }
        },
        {
            "wardens_warden": {
                "handle": "jasonxiale"
            }
        },
        {
            "wardens_warden": {
                "handle": "dan\\_\\_vinci"
            }
        },
        {
            "wardens_warden": {
                "handle": "Sparrow\\_Jac"
            }
        },
        {
            "wardens_warden": {
                "handle": "7"
            }
        },
        {
            "wardens_warden": {
                "handle": "silver\\_eth"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Sherlock",
        "logo_square": "sherlock_square.png"
    },
    "protocols_protocol": {
        "name": "Mellow Flexible Vaults",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}