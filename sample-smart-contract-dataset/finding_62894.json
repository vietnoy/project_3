{
    "id": 62894,
    "kind": "PDF",
    "auditfirm_id": 6,
    "impact": "HIGH",
    "finders_count": 4,
    "protocol_id": 3419,
    "title": "CREATE/CREATE2 is not disabled during a delegated EOA call allowing delegated EOA transactions",
    "content": "## To Be Invalidated Mid-Block\n\n## Severity\n**High Risk**\n\n## Context\n(No context files were provided by the reviewer)\n\n## Description\n(Issue found in commit hash `fc820c9ee9ab310c4fdd5e1888f72164c0b871c8`).\n\nThe EIP-7702 spec notes the following:\n\nA related issue is that an EOA's nonce may be incremented more than once per transaction. Because clients already need to be robust in a worse scenario (described above), it isn't a major concern. However, clients should be aware this behavior is possible and design their transaction propagation accordingly.\n\nFor Monad, this is a more serious concern because of delayed execution. A preceding transaction can invalidate other transactions in a proposal by bumping the delegated EOA's nonce via `CREATE` / `CREATE2`. This invalid transaction will thus not be charged any gas as a result but will take up space in the proposal, enabling virtually free block stuffing attacks.\n\nMonad attempts to solve this by disabling `CREATE` and `CREATE2` opcode when executing delegated code in `evmc_host.cpp`.\n\n### evmc_host.hpp (Lines 129-132)\n```cpp\nif (msg.kind == EVMC_CREATE || msg.kind == EVMC_CREATE2) {\n    if (!create_inside_delegated_ && (msg.flags & EVMC_DELEGATED)) {\n        return evmc::Result{EVMC_UNDEFINED_INSTRUCTION, msg.gas};\n    }\n}\n```\n\nBut there is a flaw with how it is handled here. Importantly, in the VM, the preceding `CREATE` / `CREATE2` opcode implementation will pass in `msg.flags = 0` when calling the EVMC Host.\n\n### create.hpp (Lines 78-94)\n```cpp\nauto message = evmc_message{\n    .kind = kind,\n    .flags = 0,\n    .depth = ctx->env.depth + 1,\n    .gas = gas,\n    .recipient = evmc::address{},\n    .sender = ctx->env.recipient,\n    .input_data = (*size > 0) ? ctx->memory.data + *offset : nullptr,\n    .input_size = *size,\n    .value = bytes32_from_uint256(value),\n    .create2_salt = bytes32_from_uint256(salt_word),\n    .code_address = evmc::address{},\n    .code = nullptr,\n    .code_size = 0,\n};\nauto result = ctx->host->call(ctx->context, &message);\n```\n\nThus, `msg.flags & EVMC_DELEGATED` will always be `0`, and the check will never work.\n\n## Recommendation\nThe check needs to be shifted into the VM layer.\n\n## Category Labs\nFixed in PR 1601.\n\n## Spearbit\nFix verified.",
    "summary": "\nThis bug report discusses a high-risk issue found in a specific commit of a code base related to EIP-7702 specifications. The issue involves the possibility of an EOA's nonce being incremented more than once per transaction, which can lead to invalid transactions and enable block stuffing attacks. The report also mentions a flaw in the handling of the issue, where a check for delegated code is not properly implemented in the code base. The recommendation is to shift the check to the VM layer. The issue has been fixed in a PR and verified by Spearbit.",
    "report_date": "2025-09-19T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Monad-Spearbit-Security-Review-September-2025.pdf",
    "github_link": "",
    "pdf_link": "https://solodit-bucket.s3.amazonaws.com/storage/reports/spearbit/Monad-Spearbit-Security-Review-September-2025.pdf",
    "pdf_page_from": 20,
    "contest_id": "",
    "slug": "createcreate2-is-not-disabled-during-a-delegated-eoa-call-allowing-delegated-eoa-transactions-spearbit-none-monad-pdf",
    "firm_name": "Spearbit",
    "firm_logo_square": "spearbit_square.png",
    "protocol_name": "Monad",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Haxatron"
            }
        },
        {
            "wardens_warden": {
                "handle": "Dtheo"
            }
        },
        {
            "wardens_warden": {
                "handle": "Guido Vranken"
            }
        },
        {
            "wardens_warden": {
                "handle": "Rikard Hjort"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Spearbit",
        "logo_square": "spearbit_square.png"
    },
    "protocols_protocol": {
        "name": "Monad",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}