{
    "id": 62504,
    "kind": "GIT",
    "auditfirm_id": 3,
    "impact": "MEDIUM",
    "finders_count": 1,
    "protocol_id": 3104,
    "title": "M-12: `PendlePTOracle._getPTRate` isn't correct for some market",
    "content": "\nSource: https://github.com/sherlock-audit/2025-06-notional-exponent-judging/issues/623 \n\n## Found by \njasonxiale\n\n### Summary\n\nQuoting from the [comment](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/main/notional-v4/src/oracles/PendlePTOracle.sol#L60C)\n>ptRate is always returned in 1e18 decimals\n\nThe `PendlePTOracle._getPTRate` function assumes `ptRate` is always in 1e18 decimals, which isn't correct for some market.\n\n\n### Root Cause\n\nIn function [PendlePTOracle._getPTRate](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/82c87105f6b32bb362d7523356f235b5b07509f9/notional-v4/src/oracles/PendlePTOracle.sol#L60-L66), two AIP will be called: `PENDLE_ORACLE.getPtToSyRate` and `PENDLE_ORACLE.getPtToAssetRate`.\n\n```solidity\n 60     /// @dev ptRate is always returned in 1e18 decimals\n 61     function _getPTRate() internal view returns (int256) {\n 62         uint256 ptRate = useSyOracleRate ?\n 63             PENDLE_ORACLE.getPtToSyRate(pendleMarket, twapDuration) :\n 64             PENDLE_ORACLE.getPtToAssetRate(pendleMarket, twapDuration);\n 65         return ptRate.toInt();\n 66     }\n```\n\n1. function `PENDLE_ORACLE.getPtToAssetRate` will always return ptRate in 1e18 decimals\n2. function `PENDLE_ORACLE.getPtToSyRate` will return ptRate in larger decimals for some markets.\n\nFor example: market 0x83916356556f51dcBcB226202c3efeEfc88d5eaA, 0x9471d9c5B57b59d42B739b00389a6d520c33A7a9, 0x08946D1070bab757931d39285C12FEf4313b667B, 0x1C3bA40210fa290de13c62Fe1a9EfcB694725D10, 0x0271A803f0d3Dec9cCd105A4A4d41e6Ee1458765, 0xEDda7526EC81055F2af99d51D968FC2FBca9Ee96, 0xE4AF6375F4424b61B91A1E96b9dE6ff8E842AA3A\nBecase [PENDLE_ORACLE](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/82c87105f6b32bb362d7523356f235b5b07509f9/notional-v4/src/interfaces/IPendle.sol#L411) is defined as `0x66a1096C6366b2529274dF4f5D8247827fe4CEA8`, we can query those market direct from the cast.\n```bash\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x83916356556f51dcBcB226202c3efeEfc88d5eaA 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x9471d9c5B57b59d42B739b00389a6d520c33A7a9 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x08946D1070bab757931d39285C12FEf4313b667B 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x1C3bA40210fa290de13c62Fe1a9EfcB694725D10 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x0271A803f0d3Dec9cCd105A4A4d41e6Ee1458765 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0xEDda7526EC81055F2af99d51D968FC2FBca9Ee96 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0xE4AF6375F4424b61B91A1E96b9dE6ff8E842AA3A 3600;\n```\n\n\n\n### Internal Pre-conditions\n\nNone\n\n### External Pre-conditions\n\nNone\n\n### Attack Path\n\nFor example: market 0x83916356556f51dcBcB226202c3efeEfc88d5eaA, 0x9471d9c5B57b59d42B739b00389a6d520c33A7a9, 0x08946D1070bab757931d39285C12FEf4313b667B, 0x1C3bA40210fa290de13c62Fe1a9EfcB694725D10, 0x0271A803f0d3Dec9cCd105A4A4d41e6Ee1458765, 0xEDda7526EC81055F2af99d51D968FC2FBca9Ee96, 0xE4AF6375F4424b61B91A1E96b9dE6ff8E842AA3A\nBecase [PENDLE_ORACLE](https://github.com/sherlock-audit/2025-06-notional-exponent/blob/82c87105f6b32bb362d7523356f235b5b07509f9/notional-v4/src/interfaces/IPendle.sol#L411) is defined as `0x66a1096C6366b2529274dF4f5D8247827fe4CEA8`, we can query those market direct from the cast.\n```bash\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x83916356556f51dcBcB226202c3efeEfc88d5eaA 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x9471d9c5B57b59d42B739b00389a6d520c33A7a9 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x08946D1070bab757931d39285C12FEf4313b667B 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x1C3bA40210fa290de13c62Fe1a9EfcB694725D10 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0x0271A803f0d3Dec9cCd105A4A4d41e6Ee1458765 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0xEDda7526EC81055F2af99d51D968FC2FBca9Ee96 3600;\ncast call -r https://eth-mainnet.public.blastapi.io 0x66a1096C6366b2529274dF4f5D8247827fe4CEA8 \"getPtToSyRate(address,uint32)(uint256)\"  0xE4AF6375F4424b61B91A1E96b9dE6ff8E842AA3A 3600;\n```\n\n\n### Impact\n\nIncorrect `ptRate` will cause the incrrect price returned by the oracle.\n\n### PoC\n\n_No response_\n\n### Mitigation\n\n_No response_\n\n",
    "summary": "\nThis bug report is about a problem found by a user named jasonxiale. The issue is related to a function called `_getPTRate` in a contract called `PendlePTOracle`. The function assumes that a variable called `ptRate` is always in a certain format, but this is not correct for some markets. This can lead to incorrect prices being returned by the oracle. A possible solution to this problem is to update the function to handle different formats of `ptRate` for different markets. ",
    "report_date": "2025-07-18T15:00:00.000Z",
    "contest_prize_txt": "75500 USDC",
    "contest_link": "https://app.sherlock.xyz/audits/contests/1001",
    "sponsor_name": "",
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "",
    "github_link": "https://github.com/sherlock-audit/2025-06-notional-exponent-judging/issues/623",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "1001",
    "slug": "m-12-pendleptoracle_getptrate-isnt-correct-for-some-market-sherlock-notional-exponent-git",
    "firm_name": "Sherlock",
    "firm_logo_square": "sherlock_square.png",
    "protocol_name": "Notional Exponent",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "jasonxiale"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Sherlock",
        "logo_square": "sherlock_square.png"
    },
    "protocols_protocol": {
        "name": "Notional Exponent",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}