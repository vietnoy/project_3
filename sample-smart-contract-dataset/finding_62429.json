{
    "id": 62429,
    "kind": "MARKDOWN",
    "auditfirm_id": 34,
    "impact": "MEDIUM",
    "finders_count": 1,
    "protocol_id": 3407,
    "title": "[ZLS1-3] An attacker can set the exchange rate of ZEALInfinityPool to a very large or unlimited value",
    "content": "**Severity:** Medium\n\n**Path:** contracts/ZEALInfinityPool.sol#L192-L194\ncontracts/ZEALInfinityPool.sol#L85-L99\n\n**Description:** In the ZEALInfinityPool contract, the exchange rate between staked Zeal tokens and minted xZeal tokens always increases, using the `highestExchangeRate` variable as a minimum bound.\n```\nfunction getExchangeRate() public view returns (uint256) {\n    uint256 xSupply = xZealToken.totalSupply();\n    if (xSupply == 0) {\n        return highestExchangeRate; // Return highest rate if no supply\n    }\n    uint256 currentRate = (totalStaked + totalRewards).mulDiv(\n        PRECISION_FACTOR,\n        xSupply\n    );\n\n    return\n        currentRate > highestExchangeRate\n            ? currentRate\n            : highestExchangeRate;\n}\n```\n```\nfunction stake(uint256 _amount) external nonReentrant {\n    ...\n    if (xSupply == 0) {\n        currentRate = PRECISION_FACTOR;\n    } else {\n        currentRate = (totalStaked + totalRewards).mulDiv(\n            PRECISION_FACTOR,\n            xSupply\n        );\n    }\n\n    currentRate = currentRate > highestExchangeRate\n        ? currentRate\n        : highestExchangeRate;\n    ...\n```\nHowever, even when the current supply is zero, the contract still uses the previous `highestExchangeRate` as the minimum bound. This allows an attacker to repeatedly stake and unstake when the supply is zero, inflating the exchange rate, especially when rewards are added. \n\nWith no cost, the attacker can inflate the exchange rate to an extremely large or even unlimited value, effectively preventing others from staking into the contract (DoS).\n\nExample:\n\n1. Initially, `currentRate = highestExchangeRate = PRECISION_FACTOR` (1e18).\nThe attacker stakes 1e18 Zeal tokens and receives 1e18 xZeal shares.\n\n2. The attacker then adds 1e18 Zeal tokens as rewards. Now, `highestExchangeRate = currentRate = 2e18`.\nThe attacker unstakes 1e18 xZeal shares and receives the full 2e18 Zeal tokens, because the exchange rate for unstaking is set to `highestExchangeRate` when the remaining xZeal supply is zero.\n\n3. Next, the attacker stakes 1e18 Zeal tokens again but receives only 0.5e18 xZeal shares, since the `highestExchangeRate` is now 2e18.\nThe attacker can then add 1e18 Zeal tokens as rewards and unstake the 0.5e18 xZeal shares, doubling the exchange rate to 4e18.\n\n4. By repeating this process (with just 2e18 Zeal tokens), the attacker can increase the `highestExchangeRate` to a very large value, making it so that any new Zeal token stakes will receive zero shares -  effectively causing a denial-of-service (DoS) on the pool.\n\n**Remediation:**  Consider reseting `highestExchangeRate` to its default value whenever the total supply returns to zero.\n\n**Status:**  Fixed\n\n\n- - -",
    "summary": "\nThis bug report discusses a medium severity issue in the ZEALInfinityPool contract. The problem occurs in two specific areas of the code and allows an attacker to manipulate the exchange rate between staked Zeal tokens and minted xZeal tokens. This can lead to a denial-of-service (DoS) attack, where the attacker can inflate the exchange rate and prevent others from staking into the contract. The report suggests resetting the `highestExchangeRate` variable to its default value when the total supply returns to zero as a possible solution. The bug has been fixed.",
    "report_date": "2025-05-26T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/solodit/solodit_content/blob/main/reports/Hexens/2025-05-26-Zealous.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "zls1-3-an-attacker-can-set-the-exchange-rate-of-zealinfinitypool-to-a-very-large-or-unlimited-value-hexens-none-zealous-markdown",
    "firm_name": "Hexens",
    "firm_logo_square": "Hexens_square.png",
    "protocol_name": "Zealous",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Hexens"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Hexens",
        "logo_square": "Hexens_square.png"
    },
    "protocols_protocol": {
        "name": "Zealous",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}