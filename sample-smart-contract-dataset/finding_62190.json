{
    "id": 62190,
    "kind": "MARKDOWN",
    "auditfirm_id": 16,
    "impact": "LOW",
    "finders_count": 1,
    "protocol_id": 2031,
    "title": "[L-03] Aave V3 price source can be inaccurate",
    "content": "\n_Resolved_\n\n\r\nThe `UsrRedemptionExtension` contract relies on Aave V3's oracle system to determine withdrawal token amounts during redemption. However, the implementation has potential price accuracy issues due to how it interacts with `Chainlink` oracles.\r\n\r\n```solidity\r\n    function redeem(\r\n        uint256 _amount,\r\n        address _receiver,\r\n        address _withdrawalTokenAddress\r\n    ) public whenNotPaused allowedWithdrawalToken(_withdrawalTokenAddress) onlyRole(SERVICE_ROLE) {\r\n        ...\r\n        IAaveOracle aavePriceOracle = IAaveOracle(ADDRESSES_PROVIDER.getPriceOracle());\r\n        uint256 withdrawalTokenAmount = (_amount * aavePriceOracle.getAssetPrice(_withdrawalTokenAddress))\r\n            / (aavePriceOracle.BASE_CURRENCY_UNIT() * 10 ** (USR_DECIMALS - withdrawalTokenDecimals));\r\n        ...\r\n    }\r\n```\r\n\r\nThe issue is from two main problems in Aave V3's oracle implementation:\r\n\r\n```solidity\r\n  function getAssetPrice(address asset) public view override returns (uint256) {\r\n    AggregatorInterface source = assetsSources[asset];\r\n\r\n    if (asset == BASE_CURRENCY) {\r\n      return BASE_CURRENCY_UNIT;\r\n    } else if (address(source) == address(0)) {\r\n      return _fallbackOracle.getAssetPrice(asset);\r\n    } else {\r\n      int256 price = source.latestAnswer(); // @audit call source.latestAnswer\r\n      if (price > 0) {\r\n        return uint256(price);\r\n      } else {\r\n        return _fallbackOracle.getAssetPrice(asset);\r\n      }\r\n    }\r\n```\r\n\r\nLet's inspect Aave V3's price source of USDT: `0xC26D4a1c46d884cfF6dE9800B6aE7A8Cf48B4Ff8`\r\n\r\n- Unsafe price fetching: The Aave oracle uses `latestAnswer` instead of `latestRoundData` when querying Chainlink price feeds. No validation of price staleness is performed.\r\n- Artificially capped prices may not reflect true market conditions\r\n\r\n`PriceCapAdapterStable` contract:\r\n```solidity\r\n  function latestAnswer() external view override returns (int256) {\r\n    int256 basePrice = ASSET_TO_USD_AGGREGATOR.latestAnswer(); // @audit call latestAnswer instead of latestRoundData\r\n    int256 priceCap = _priceCap;\r\n\r\n    if (basePrice > priceCap) { // @audit price is capped\r\n      return priceCap;\r\n    }\r\n\r\n    return basePrice;\r\n  }\r\n\r\n```\r\n\r\nAs a result, users could receive incorrect amounts during token redemptions.\r\n\r\nIt's recommended to implement direct Chainlink oracle price fetching and validate price freshness.\n\n\n\n",
    "summary": "",
    "report_date": "2025-08-27T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/pashov/audits/blob/master/team/md/Resolv-security-review_2024-12-09.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "l-03-aave-v3-price-source-can-be-inaccurate-pashov-audit-group-none-resolv_2024-12-09-markdown_",
    "firm_name": "Pashov Audit Group",
    "firm_logo_square": "Pashov_square.png",
    "protocol_name": "Resolv_2024-12-09",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Pashov Audit Group"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Pashov Audit Group",
        "logo_square": "Pashov_square.png"
    },
    "protocols_protocol": {
        "name": "Resolv_2024-12-09",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}