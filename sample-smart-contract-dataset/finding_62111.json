{
    "id": 62111,
    "kind": "GIT",
    "auditfirm_id": 3,
    "impact": "HIGH",
    "finders_count": 3,
    "protocol_id": 3135,
    "title": "H-6: Redeems through RedeemQueue avoid paying management and performance fee.",
    "content": "\nSource: https://github.com/sherlock-audit/2025-07-mellow-flexible-vaults-judging/issues/491 \n\n## Found by \nbughuntoor, t.aksoy, tedox\n\n### Summary\n\nWhen a user calls `redeem`, the amount of shares they want to redeem is immediately burned, effectively removing the shares from `activeShares` \n\n```solidity\n        IShareManager shareManager_ = IShareManager(IShareModule(vault_).shareManager());\n        shareManager_.burn(caller, shares);\n        {\n            IFeeManager feeManager = IShareModule(vault_).feeManager();\n            uint256 fees = feeManager.calculateRedeemFee(shares);\n            if (fees > 0) {\n                shareManager_.mint(feeManager.feeRecipient(), fees);\n                shares -= fees;\n            }\n        }\n```\n\nHowever, although the shares are burned, the funds actually remain within the vault up until a report is handled and it handles said redeems. For these reasons these funds should also be subject to performance and management fees (both for the time period between last fee accrual and creating redeem request and also after creating redeem request and up to report handling.\n\nAs the code does considers for `totalShares` only the `allocated` and minted shares, but not the ones waiting in redeem queue, the shares in redeem queue effectively bypass the necessary fees.\n\n### Root Cause\n\nFlawed logic.\n\n### Code\nhttps://github.com/sherlock-audit/2025-07-mellow-flexible-vaults/blob/main/flexible-vaults/src/queues/RedeemQueue.sol#L98\n\n### Attack Path\n\n1. Reports are handled once a day.\n2. Last report is at 00:00.\n3. User creates a redeem request at 12:00. (12 hours since last report)\n4. A new report comes at 00:00 (24 hours since previous report). \n5. The user claims their redeem and does not pay any fees for the past day.\n\n### Impact\n\nLoss of vault fees.\n\n### PoC\n\n_No response_\n\n### Mitigation\n\nWhen user creates a redeem request, transfer the fees to the queue contract. Burn the shares only when the request is handled (within `_handleReport`).\n\n\n\n## Discussion\n\n**sherlock-admin2**\n\nThe protocol team fixed this issue in the following PRs/commits:\nhttps://github.com/mellow-finance/flexible-vaults/pull/29\n\n\n\n\n",
    "summary": "\nThis bug report discusses an issue found by a group of users regarding the `redeem` function in the `RedeemQueue` contract. When a user redeems their shares, the shares are immediately burned, but the funds remain in the vault until a report is handled. This means that these funds are not subject to performance and management fees, which results in a loss of fees for the vault. The root cause of this issue is flawed logic in the code. The attack path involves creating a redeem request after the last report is handled, which allows the user to claim their redeem without paying any fees for the past day. The impact of this bug is a loss of vault fees. The protocol team has fixed this issue in a recent pull request. To mitigate this issue, the team suggests transferring the fees to the queue contract when a user creates a redeem request and only burning the shares when the request is handled. ",
    "report_date": "2025-07-28T15:00:00.000Z",
    "contest_prize_txt": "70000 USDC",
    "contest_link": "https://app.sherlock.xyz/audits/contests/964",
    "sponsor_name": "",
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "",
    "github_link": "https://github.com/sherlock-audit/2025-07-mellow-flexible-vaults-judging/issues/491",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "964",
    "slug": "h-6-redeems-through-redeemqueue-avoid-paying-management-and-performance-fee-sherlock-mellow-flexible-vaults-git",
    "firm_name": "Sherlock",
    "firm_logo_square": "sherlock_square.png",
    "protocol_name": "Mellow Flexible Vaults",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "tedox"
            }
        },
        {
            "wardens_warden": {
                "handle": "t.aksoy"
            }
        },
        {
            "wardens_warden": {
                "handle": "bughuntoor"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Sherlock",
        "logo_square": "sherlock_square.png"
    },
    "protocols_protocol": {
        "name": "Mellow Flexible Vaults",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}