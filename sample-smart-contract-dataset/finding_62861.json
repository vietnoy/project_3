{
    "id": 62861,
    "kind": "MARKDOWN",
    "auditfirm_id": 30,
    "impact": "LOW",
    "finders_count": 1,
    "protocol_id": 3449,
    "title": "[L-05] The `setSwapRouter()` in `GasTank` Is Not Revoking the Previous Approval",
    "content": "\n## Severity\n\nLow Risk\n\n## Description\n\nWhen setting up our paymaster, we call `_initUniswapHelper()`, which adds the swapRouter address. We make full approval for the router for this token, so that it can pull assets from the GasTank without approving each tx.\n\nFile: [UniswapHelper.sol#L43](https://github.com/etherspot/etherspot-modular-accounts/blob/9019f2a78c36e74bdb1df4029672998cb4631162/src/paymaster/utils/UniswapHelper.sol#L43)\n\n```solidity\nfunction _initUniswapHelper( IERC20 _token, IERC20 _wrappedNative, ISwapRouter _uniswap, UniswapHelperConfig memory _uniswapHelperConfig ) internal {\n    // code\n    // Approve router for token\n>>  _token.approve(address(_uniswap), type(uint256).max);\n    // code\n    initialized = true;\n}\n```\n\nThis router can be changed via `setSwapRouter()`, and when changing it, we make the approval for the new router. But the issue is that we are not revoking the previous approvals from the previous Uniswap Router, leaving the previous router also has approvals.\n\n## Location of Affected Code\n\nFile: [GasTankPaymaster.sol#L308-L313](https://github.com/etherspot/etherspot-modular-accounts/blob/9019f2a78c36e74bdb1df4029672998cb4631162/src/paymaster/GasTankPaymaster.sol#L308-L313)\n\n```solidity\nfunction setSwapRouter(ISwapRouter _swapRouter) external onlyOwner {\n    if (address(_swapRouter) == address(0)) revert GasTankPaymaster_InvalidAddress();\n    uniswap = _swapRouter;\n>>  token.approve(address(uniswap), type(uint256).max);\n    emit GasTankPaymaster_SwapRouterUpdated(address(_swapRouter));\n}\n```\n\n## Impact\n\nLeaving the max approval for the previous router, which will not be used.\n\n## Recommendation\n\nWe should check if the swapRouter already has values. We should revoke this approval by approving `0` tokens in `setSwapRouter()` before approving the new router.\n\n## Team Response\n\nFixed.\n\n",
    "summary": "",
    "report_date": "2025-10-03T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/shieldify-security/audits-portfolio-md/blob/main/Etherspot-GasTankPaymasterModule-Extended-Security-Review.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "l-05-the-setswaprouter-in-gastank-is-not-revoking-the-previous-approval-shieldify-none-etherspot-gastankpaymastermodule-extended-markdown",
    "firm_name": "Shieldify",
    "firm_logo_square": "Shieldify_square.png",
    "protocol_name": "Etherspot Gastankpaymastermodule Extended",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Shieldify Security"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Shieldify",
        "logo_square": "Shieldify_square.png"
    },
    "protocols_protocol": {
        "name": "Etherspot Gastankpaymastermodule Extended",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}