{
    "id": 62313,
    "kind": "PDF",
    "auditfirm_id": 6,
    "impact": "LOW",
    "finders_count": 3,
    "protocol_id": 3396,
    "title": "The word principal is used with different connotations leading to confusion",
    "content": "## Severity: Low Risk\n\n## Context\n- `ReserveLogic.sol#L259`\n- `ValidationLogic.sol#L330`\n- `ValidationLogic.sol#L335`\n- `ValidationLogic.sol#L342`\n- `ValidationLogic.sol#L349`\n- `MiniPoolLiquidationLogic.sol#L48`\n- `MiniPoolLiquidationLogic.sol#L57`\n- `MiniPoolReserveLogic.sol#L268`\n- `MiniPoolValidationLogic.sol#L335`\n- `MiniPoolValidationLogic.sol#L340`\n- `MiniPoolValidationLogic.sol#L347`\n- `MiniPoolValidationLogic.sol#L354`\n- `RewardsDistributor.sol#L457`\n- `RewardsDistributor.sol#L458`\n- `RewardsDistributor.sol#L465`\n- `RewardsDistributor.sol#L470`\n- `RewardsDistributor6909.sol#L485`\n- `RewardsDistributor6909.sol#L486`\n- `RewardsDistributor6909.sol#L493`\n- `RewardsDistributor6909.sol#L498`\n- `AToken.sol#L267`\n- `VariableDebtToken.sol#L278`\n- `VariableDebtToken.sol#L305`\n- `VariableDebtToken.sol#L307`\n- `VariableDebtToken.sol#L308`\n\n## Description\n1. In `ReserveLogic`, `MiniPoolReserveLogic`, we have:\n   ```solidity\n   // Calculate the last principal variable debt.\n   vars.previousVariableDebt = scaledVariableDebt.rayMul(previousVariableBorrowIndex);\n   ```\n   Here, principal means the actual debt principal plus the accrued interest.\n\n2. In liquidation flows, the word principal is used in conjunction with reserve to mean the debt or borrow reserve.\n\n3. In `RewardsDistributor` and `RewardsDistributor6909`, we have:\n   ```solidity\n   /**\n    * @dev Calculates rewards based on principal balance and index difference.\n    * @param principalUserBalance User's principal balance.\n    * @param reserveIndex Current reserve index.\n    * @param userIndex User's stored index.\n    * @param decimals Number of decimals.\n    * @return The calculated reward amount.\n    */\n   function _getRewards(\n       uint256 principalUserBalance,\n       uint256 reserveIndex,\n       uint256 userIndex,\n       uint8 decimals\n   ) internal pure returns (uint256) {\n       return (principalUserBalance * (reserveIndex - userIndex)) / 10 ** decimals;\n   }\n   ```\n   Here, principal, based on the analysis of the input (avoiding the mix of scaling related issues), is supposed to be the amount of shares, which is actually not the initial principal deposited or borrowed by the user.\n\n4. `AToken`: Here, the word principal actually matches with what we would consider as principal:\n   ```solidity\n   // the balance of the user: principal balance + interest generated by the principal.\n   super.balanceOf(user).rayMul(\n       _pool.getReserveNormalizedIncome(_underlyingAsset, RESERVE_TYPE)\n   )\n   ```\n\n5. In `VariableDebtToken.sol#L277-L284`, `VariableDebtToken.sol#L304-L317`: The word principal refers to the shares and total shares in this token.\n\n## Recommendation\nIn most cases, the comments or variable names need to be updated to reflect the actual value computed or stored, but in the case of point 3, the confusion can result in computing incorrect reward amounts for the user. The question arises whether the user needs to be awarded based on:\n- The principal deposited or borrowed (the true meaning of the word) or...\n- The shares of the aToken or debtToken the user holds.\n\nIf it is the first point, then the reward distribution flow needs to be updated, and the tokens would also need to store principal values along with the shares to be able to provide them to the incentive controllers.\n\n## Acknowledgments\n- **Astera:** Acknowledged.\n- **Spearbit:** Acknowledged.",
    "summary": "",
    "report_date": "2025-08-29T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Astera-Spearbit-Security-Review-December-2024.pdf",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Astera-Spearbit-Security-Review-December-2024.pdf",
    "github_link": "",
    "pdf_link": "https://solodit-bucket.s3.amazonaws.com/storage/reports/spearbit/Astera-Spearbit-Security-Review-December-2024.pdf",
    "pdf_page_from": 39,
    "contest_id": "",
    "slug": "the-word-principal-is-used-with-different-connotations-leading-to-confusion-spearbit-none-astera-pdf",
    "firm_name": "Spearbit",
    "firm_logo_square": "spearbit_square.png",
    "protocol_name": "Astera",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Saw-mon and Natalie"
            }
        },
        {
            "wardens_warden": {
                "handle": "Cergyk"
            }
        },
        {
            "wardens_warden": {
                "handle": "Jonatas Martins"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Spearbit",
        "logo_square": "spearbit_square.png"
    },
    "protocols_protocol": {
        "name": "Astera",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}