{
    "id": 62314,
    "kind": "MARKDOWN",
    "auditfirm_id": 30,
    "impact": "HIGH",
    "finders_count": 1,
    "protocol_id": 3397,
    "title": "[C-01] User Can Deny Opponent NFT Rewards By Marking Safe Post-Battle",
    "content": "\n## Severity\n\nCritical Risk\n\n## Description\n\nThe `markBeetleSafe()` function allows a user to designate one of their staked NFTs as the safe beetle at any time. The function only verifies that the caller is the staker of the token, but does not validate the timing or context of the action. As a result, a user can wait until after losing a battle and then call `markBeetleSafe()` on the threatened NFT. Because `claimBeetleFromVictory()` prohibits transferring a safe beetle, this enables a malicious participant to retroactively protect assets that should otherwise be lost.\n\n## Location of Affected Code\n\nFile: [contracts/BeetleBattleGame.sol#L231](https://github.com/rshtirmer/BeetleGame-Contracts/blob/4ab13a82a1f9b7228d5c0ad3a085518a60459036/contracts/BeetleBattleGame.sol#L231)\n\n```solidity\nfunction markBeetleSafe(uint256 _tokenId) public {\n  if (isStaked[_tokenId] != msg.sender) revert InvalidTokenOwner();\n  safeBeetle[msg.sender] = _tokenId;\n\n  emit SafeBeetleUpdated(msg.sender, _tokenId);\n}\n```\n\n## Impact\n\nWinners of battles may be unable to claim the opponent’s NFTs, as the defeated party can immediately call `markBeetleSafe()` to shield the asset after the outcome is determined. This undermines the fairness of battles, negates the reward mechanism, and weakens trust in the protocol’s economic model.\n\n## Recommendation\n\nRestrict `markBeetleSafe()` to only be called during the staking process or require a valid signer authorization to confirm the action, preventing post-battle misuse.\n\n## Team Response\n\nFixed.\n\n",
    "summary": "\nThis bug report is about a function called `markBeetleSafe()` that allows users to protect their in-game assets in a game called BeetleBattle. The function only checks if the user owns the asset, but doesn't consider when or how the function is being used. This means that a malicious user can wait until after losing a battle and then use the function to protect their assets, even though they should have lost them. This can affect the fairness of battles and the game's reward system. The recommendation is to restrict the function or require additional authorization to prevent misuse. The team has fixed the issue.",
    "report_date": "2025-08-30T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/shieldify-security/audits-portfolio-md/blob/main/Beetle-Security-Review.md",
    "github_link": "",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "",
    "slug": "c-01-user-can-deny-opponent-nft-rewards-by-marking-safe-post-battle-shieldify-none-beetle-markdown",
    "firm_name": "Shieldify",
    "firm_logo_square": "Shieldify_square.png",
    "protocol_name": "Beetle",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Shieldify Security"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Shieldify",
        "logo_square": "Shieldify_square.png"
    },
    "protocols_protocol": {
        "name": "Beetle",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}