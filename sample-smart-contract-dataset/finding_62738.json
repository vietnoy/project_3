{
    "id": 62738,
    "kind": "GIT",
    "auditfirm_id": 3,
    "impact": "MEDIUM",
    "finders_count": 6,
    "protocol_id": 3324,
    "title": "M-15: If Across Bridging fails, all funds intended for bridging will become locked",
    "content": "\nSource: https://github.com/sherlock-audit/2025-07-malda-judging/issues/1309 \n\n## Found by \n0xapple, 10ap17, ExtraCaterpillar, SafetyBytes, ZeroTrust, cergyk\n\n### Summary\n\nIf the Across bridging process fails, funds intended for bridging become locked in the Rebalancer contract, making them inaccessible.\n\n\n\n### Root Cause\n\nWhen the Across bridge calls the depositV3Now function, the depositor is set as the Rebalancer. According to the Across documentation, if a deposit expires or a fill fails, funds are refunded to the depositor on the origin chain. When the bridging process using Across fails, the refunded assets are returned to the Rebalancer, making them completely locked and inaccessible. \nFrom Across docs:\n- `In cases where a slow fill can't or does not happen and a relayer does not fill the intent, the intent expires. Like a slow fill, this expiry must be optimistically verified, which takes a few hours. Once this verification is done, the user is then refunded their money on the origin chain.`\n\nAs seen bellow, Rebalancer is set as depositor: \n```solidity\n function _depositV3Now(bytes memory _message, address _token, uint32 _dstChainId, address _market) private {\n        DecodedMessage memory msgData = _decodeMessage(_message);\n        // approve and send with Across\n        SafeApprove.safeApprove(_token, address(acrossSpokePool), msgData.inputAmount);\n        IAcrossSpokePoolV3(acrossSpokePool).depositV3Now( // no need for `msg.value`; fee is taken from amount\n            msg.sender, //depositor\n            address(this), //recipient\n            _token,\n            address(0), //outputToken is automatically resolved to the same token on destination\n            msgData.inputAmount,\n            msgData.outputAmount, //outputAmount should be set as the inputAmount - relay fees; use Across API\n            uint256(_dstChainId),\n            msgData.relayer, //exclusiveRelayer\n            msgData.deadline, //fillDeadline\n            msgData.exclusivityDeadline, //can use Across API/suggested-fees or 0 to disable\n            abi.encode(_market)\n        );\n    }\n```\n\nhttps://github.com/sherlock-audit/2025-07-malda/blob/798d00b879b8412ca4049ba09dba5ae42464cfe7/malda-lending/src/rebalancer/bridges/AcrossBridge.sol#L168\n\n### Internal Pre-conditions\n\n/\n\n### External Pre-conditions\n\n/\n\n### Attack Path\n\n- The Rebalancer initiates the bridging process using AcrossBridge.  \n- The depositV3Now function is called with the Rebalancer set as the depositor.  \n- The bridging process fails.  \n- Funds are refunded to the Rebalancer(depositor) on the origin chain.  \n- The funds are now locked, as there is no mechanism for the Rebalancer to use them or return them to the market.\n\n\n\n### Impact\n\nFunds become completely locked inside the Rebalancer contract and are effectively lost.\n\n\n\n### PoC\n\n_No response_\n\n### Mitigation\n\nConsider adding helper function in Rebalancer contract, that could rescue returned tokens to the intended market.\n\n## Discussion\n\n**sherlock-admin2**\n\nThe protocol team fixed this issue in the following PRs/commits:\nhttps://github.com/malda-protocol/malda-lending/pull/126\n\n\n**CergyK**\n\nFix looks good\n\n**Barnadrot**\n\nAdded the suggested changes, good to merge now? \n\n\n**CergyK**\n\n> Added the suggested changes, good to merge now?\n\nYes good to merge\n\n\n\n",
    "summary": "\nThis bug report discusses an issue with the Across bridging process in the Malda lending protocol. When the bridging process fails, funds intended for bridging become locked in the Rebalancer contract, making them inaccessible. This is due to the Rebalancer being set as the depositor in the depositV3Now function, which means that any refunded funds from a failed bridging process are returned to the Rebalancer and cannot be used or returned to the market. This bug has been fixed by the protocol team in a recent pull request. A suggested mitigation for this issue is to add a helper function in the Rebalancer contract to rescue any returned tokens to the intended market. ",
    "report_date": "2025-08-14T17:00:00.000Z",
    "contest_prize_txt": "80000 USDC",
    "contest_link": "https://app.sherlock.xyz/audits/contests/1029",
    "sponsor_name": "",
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "",
    "github_link": "https://github.com/sherlock-audit/2025-07-malda-judging/issues/1309",
    "pdf_link": "",
    "pdf_page_from": 0,
    "contest_id": "1029",
    "slug": "m-15-if-across-bridging-fails-all-funds-intended-for-bridging-will-become-locked-sherlock-malda-git",
    "firm_name": "Sherlock",
    "firm_logo_square": "sherlock_square.png",
    "protocol_name": "Malda",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "cergyk"
            }
        },
        {
            "wardens_warden": {
                "handle": "ExtraCaterpillar"
            }
        },
        {
            "wardens_warden": {
                "handle": "0xapple"
            }
        },
        {
            "wardens_warden": {
                "handle": "10ap17"
            }
        },
        {
            "wardens_warden": {
                "handle": "ZeroTrust"
            }
        },
        {
            "wardens_warden": {
                "handle": "SafetyBytes"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Sherlock",
        "logo_square": "sherlock_square.png"
    },
    "protocols_protocol": {
        "name": "Malda",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}