{
    "id": 62151,
    "kind": "PDF",
    "auditfirm_id": 6,
    "impact": "MEDIUM",
    "finders_count": 4,
    "protocol_id": 3384,
    "title": "Incorrect bound check when updating the findex",
    "content": "## Severity: Medium Risk\n\n## Context\nFIndexOracle.sol#L52-L53\n\n## Description\nWhen `updateFloatingRate` is called by a keeper, the value provided as `floatingRate` is actually a time-weighted value \\( r_s \\, t_s \\) (where \\( s \\) indexes the \\( s \\)-th update and \\( t_s \\) is the delta time between the \\( s \\)-th update and its previous one). Therefore, when one accumulates these values into `_latestFIndex`, one computes (floatingIndex):\n\n\\[\n\\text{floatingIndex} = \\sum_s r_s t_s\n\\]\n\nAbove, \\( r_s \\) corresponds to `_latestAnnualizedRate`, and the same value is used as the settlement rate in the Proof for the Boros paper, Section 10. In this section, all bounds rely on \\(|r_s - r_m|\\), where \\( r_m \\) is the mark rate. The maximum deviation for the bound is performed using the following inequality:\n\n\\[\n|r_m - r_s t_s| \\leq \\sigma\n\\]\n\n## Recommendation\nThe above error may have been caused by the naming of the `floatingRate` parameter. It would be best to rename all instances of this value to `floatingIndexDelta` and update the inequality check so that:\n\n\\[\n|r_m - r_s| \\leq \\sigma\n\\]\n\nIn other words, roughly (further gas optimizations can be applied):\n\n```solidity\nrequire(\n    (markRate - _latestAnnualizedRate).abs() <= params.maxFRateDeviation,\n    Err.FIndexDeviationTooHigh()\n);\n```\n\nIt would make more sense to bound:\n\n\\[\n\\frac{|r_m - r_s|}{r_m + r} \\leq \\sigma\n\\]\n\nwhich corresponds to something like:\n\n```solidity\nrequire(\n    (markRate - _latestAnnualizedRate).abs() <=\n    params.maxFRateDeviation.mulDown( // need to double-check whether to use `mulDown` or a different variation due to precision of the factors involved.\n    markRate.abs().max(k_iThresh) // `k_iThresh` needs to be fetched from the market\n    ),\n    Err.FIndexDeviationTooHigh()\n);\n```\n\nOne can even take this further to bound the settlement health jump \\( D_{s,i}(r_m, r_s) \\):\n\n\\[\nD_{s,i}(r_m, r_s) = t \\cdot (t_s - t) + \\cdot |r_s - r_m| \\cdot \\frac{\\lambda_{MM}}{r_m + r \\alpha} \\leq \\sigma\n\\]\n\n## Pendle Finance\nThe floating rate bound check is removed. The goal is to reduce redundant circular dependencies. We will verify the trustworthiness of the data reported by Chainlink off-chain before updating on-chain.\n\n## Spearbit\nThe check in the finding and related parameters are removed from the codebase in commit `e2aa73d0`. Perhaps these accounting tasks are performed off-chain now by Pendle.",
    "summary": "\nThis report discusses a bug found in the code for FIndexOracle.sol, which is used in the Pendle Finance and Spearbit platforms. The bug is considered to have a medium risk severity and is related to the `updateFloatingRate` function. When this function is called by a keeper, the value provided as `floatingRate` is actually a time-weighted value, which can cause errors in the calculation of the floating index. The recommendation is to rename the `floatingRate` parameter to `floatingIndexDelta` and update the inequality check to prevent these errors. The report also mentions that the floating rate bound check has been removed in the codebase, possibly due to accounting tasks being performed off-chain now. ",
    "report_date": "2025-08-22T00:00:00.000Z",
    "contest_prize_txt": "",
    "contest_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Pendle-Spearbit-Security-Review-August-2025.pdf",
    "sponsor_name": null,
    "sponsor_link": "",
    "quality_score": 0,
    "general_score": 0,
    "source_link": "https://github.com/spearbit/portfolio/blob/master/pdfs/Pendle-Spearbit-Security-Review-August-2025.pdf",
    "github_link": "",
    "pdf_link": "https://solodit-bucket.s3.amazonaws.com/storage/reports/spearbit/Pendle-Spearbit-Security-Review-August-2025.pdf",
    "pdf_page_from": 31,
    "contest_id": "",
    "slug": "incorrect-bound-check-when-updating-the-findex-spearbit-none-pendle-core-v3-pdf",
    "firm_name": "Spearbit",
    "firm_logo_square": "spearbit_square.png",
    "protocol_name": "Pendle Core v3",
    "bookmarked": false,
    "read": false,
    "issues_issue_finders": [
        {
            "wardens_warden": {
                "handle": "Saw-mon and Natalie"
            }
        },
        {
            "wardens_warden": {
                "handle": "Ethan"
            }
        },
        {
            "wardens_warden": {
                "handle": "Desmond Ho"
            }
        },
        {
            "wardens_warden": {
                "handle": "RustyRabbit"
            }
        }
    ],
    "auditfirms_auditfirm": {
        "name": "Spearbit",
        "logo_square": "spearbit_square.png"
    },
    "protocols_protocol": {
        "name": "Pendle Core v3",
        "protocols_protocolcategoryscore": []
    },
    "issues_issuetagscore": []
}